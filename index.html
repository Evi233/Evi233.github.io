<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çƒ­æ°”çƒå¤§å†’é™© - å åŠ æŠ¤ç›¾ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
            font-family: 'Arial', sans-serif;
            touch-action: none;
            user-select: none;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* å·¦ä¸Šè§’åˆ†æ•° */
        #score-board {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* å³ä¸Šè§’çŠ¶æ€æ  */
        #status-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        #shield-status, #magnet-status {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s, transform 0.2s;
        }

        #shield-status { background: rgba(64, 158, 255, 0.9); color: white; font-weight: bold;}
        #shield-status.active { opacity: 1; transform: scale(1); }
        #shield-status.shake { animation: shake 0.5s; }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        #magnet-status { background: rgba(255, 255, 255, 0.9); }
        #magnet-status.active { opacity: 1; }

        #magnet-bar-container {
            width: 80px;
            height: 8px;
            background-color: #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin: 0 10px;
        }
        #magnet-bar { width: 100%; height: 100%; background-color: #ff4757; }

        /* é€šç”¨é®ç½©å±‚ */
        .overlay-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
            color: white;
            z-index: 10;
            backdrop-filter: blur(8px);
            transition: opacity 0.3s;
        }

        .hidden { display: none !important; }

        /* èœå•æ ·å¼ */
        h1 { font-size: 42px; margin: 0 0 10px 0; text-shadow: 3px 3px 0 #333; color: #fff; }
        .coin-display { 
            font-size: 24px; color: #FFD700; margin-bottom: 20px; 
            background: rgba(0,0,0,0.5); padding: 8px 20px; border-radius: 20px;
            display: flex; align-items: center; gap: 8px;
        }
        
        .btn-group { display: flex; gap: 20px; margin-top: 20px; }

        button {
            padding: 12px 30px;
            font-size: 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.1s;
            font-weight: bold;
            color: white;
        }
        button:active { transform: scale(0.95); }
        
        .btn-start { background: linear-gradient(to bottom, #ff8c00, #ff6b00); }
        .btn-shop { background: linear-gradient(to bottom, #9b59b6, #8e44ad); }
        .btn-close { background: #555; margin-top: 20px; }

        /* ç»“ç®—é¢æ¿ */
        #result-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .result-row { margin: 10px 0; font-size: 18px; color: #ddd; }
        .highlight { color: #FFD700; font-weight: bold; font-size: 24px; }

        /* å•†åº—ç•Œé¢ */
        #shop-screen { z-index: 20; }
        
        .shop-container {
            background: white;
            color: #333;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .shop-item.purchased {
            border-color: #4cd137;
            background: #eaffea;
        }
        
        /* æŠ¤ç›¾å¯ä»¥ä¹°å¤šä¸ªï¼Œæ‰€ä»¥ä¸å®Œå…¨ç”¨ purchased æ ·å¼ï¼Œè€Œæ˜¯ç”¨æ–‡å­—æç¤º */
        .shop-item.stackable {
             border-left: 5px solid #4cd137;
        }

        .item-info { display: flex; align-items: center; gap: 10px; text-align: left; }
        .item-icon { font-size: 30px; }
        .item-details h3 { margin: 0; font-size: 16px; }
        .item-details p { margin: 5px 0 0 0; font-size: 12px; color: #666; }
        .item-count-badge {
            background: #ff4757; color: white; font-size: 10px; padding: 2px 6px; 
            border-radius: 10px; margin-left: 5px; display: none;
        }

        .btn-buy {
            padding: 8px 16px;
            font-size: 14px;
            background: #4cd137;
            border-radius: 8px;
            min-width: 80px;
        }
        .btn-buy:disabled { background: #ccc; cursor: not-allowed; }

    </style>
</head>
<body>

    <!-- æ¸¸æˆ UI -->
    <div id="ui-layer">
        <div id="score-board">
            <span>â­ <span id="score-val">0</span></span>
        </div>
        
        <div id="status-container">
            <div id="shield-status">ğŸ›¡ï¸ æŠ¤ç›¾ x <span id="shield-count-val">0</span></div>
            <div id="magnet-status">
                <span style="font-size: 20px;">ğŸ§²</span>
                <div id="magnet-bar-container"><div id="magnet-bar"></div></div>
                <span id="magnet-timer-text">30s</span>
            </div>
        </div>
    </div>

    <!-- ä¸»èœå• / ç»“ç®—ç•Œé¢ -->
    <div id="menu-screen" class="overlay-screen">
        <h1 id="menu-title">çƒ­æ°”çƒå¤§å†’é™©</h1>
        
        <div id="result-panel" class="hidden">
            <div class="result-row">æœ¬å±€å¾—åˆ†: <span id="final-score">0</span></div>
            <div class="result-row">ğŸ’° ç»§æ‰¿(70%): <span id="inherited-coins" class="highlight">+0</span></div>
        </div>

        <div class="coin-display">
            <span>ğŸ’° é’±åŒ…ä½™é¢:</span>
            <span id="total-coins">0</span>
        </div>
        
        <p style="color: #aaa; font-size: 14px; margin-top:0;">(å¾—åˆ†çš„70%è‡ªåŠ¨å­˜å…¥é’±åŒ…)</p>

        <div class="btn-group">
            <button class="btn-shop" onclick="openShop()">ğŸª é“å…·å•†åº—</button>
            <button class="btn-start" onclick="startGame()">ğŸš€ å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- å•†åº—ç•Œé¢ -->
    <div id="shop-screen" class="overlay-screen hidden">
        <div class="shop-container">
            <div class="shop-header">
                <h2 style="margin:0;">é“å…·å•†åº—</h2>
                <div style="font-weight:bold; color:#f39c12;">ğŸ’° <span id="shop-coins">0</span></div>
            </div>

            <!-- å•†åº—ç‰©å“: æŠ¤ç›¾ (å¯å åŠ ) -->
            <div class="shop-item stackable" id="item-shield">
                <div class="item-info">
                    <span class="item-icon">ğŸ›¡ï¸</span>
                    <div class="item-details">
                        <h3>èƒ½é‡æŠ¤ç›¾ <span id="shop-shield-count" class="item-count-badge">å·²è´­: 0</span></h3>
                        <p>å¯å åŠ ! æŠµæŒ¡ä¸€æ¬¡ä¼¤å®³</p>
                    </div>
                </div>
                <button class="btn-buy" onclick="buyItem('shield', 200)">200 ğŸ’°</button>
            </div>

            <!-- å•†åº—ç‰©å“: ç£é“ (å•æ¬¡) -->
            <div class="shop-item" id="item-magnet">
                <div class="item-info">
                    <span class="item-icon">ğŸ§²</span>
                    <div class="item-details">
                        <h3>è¶…çº§ç£é“</h3>
                        <p>å¼€å±€è‡ªå¸¦30ç§’å¼ºåŠ›ç£é“</p>
                    </div>
                </div>
                <button class="btn-buy" onclick="buyItem('magnet', 350)">350 ğŸ’°</button>
            </div>

            <button class="btn-close" onclick="closeShop()">è¿”å›èœå•</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // --- æ¸¸æˆå…¨å±€å˜é‡ ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ç©å®¶æ•°æ®ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
        let userWallet = parseInt(localStorage.getItem('balloon_wallet_v2')) || 0;
        
        // å•†åº—è´­ä¹°çŠ¶æ€ï¼ˆæ¯å±€é‡ç½®ï¼‰
        // å‡çº§ï¼šæŠ¤ç›¾ç°åœ¨æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºä¹°äº†å‡ ä¸ª
        let purchasedBuffs = {
            shieldCount: 0,
            magnet: false
        };

        // æ¸¸æˆè¿è¡Œæ—¶å˜é‡
        let score = 0;
        let gameRunning = false;
        let animationId;
        let lastTime = 0;
        let speedMultiplier = 1.0;

        let magnetActive = false;
        let magnetTimer = 0;
        
        // å‡çº§ï¼šæ¸¸æˆå†…çš„æŠ¤ç›¾ä¹Ÿæ˜¯æ•°å­—
        let currentShields = 0;

        const MAGNET_DURATION = 30;
        const MAGNET_BASE_RANGE = 300;
        
        let clouds = [];
        let obstacles = [];
        let items = [];
        let particles = [];

        const player = { x: 0, y: 0, radius: 25, emoji: 'ğŸˆ', targetX: 0 };

        // --- åˆå§‹åŒ– UI ---
        updateWalletDisplay();

        function updateWalletDisplay() {
            document.getElementById('total-coins').innerText = userWallet;
            document.getElementById('shop-coins').innerText = userWallet;
            localStorage.setItem('balloon_wallet_v2', userWallet);
        }

        // --- é€‚é…ä¸è¾“å…¥ ---
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (!gameRunning) {
                player.x = canvas.width / 2;
                player.y = canvas.height - 150;
                player.targetX = player.x;
            }
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const handleInput = (x) => { if (gameRunning) player.targetX = x; };
        canvas.addEventListener('mousemove', e => handleInput(e.clientX));
        canvas.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e.touches[0].clientX); }, { passive: false });
        canvas.addEventListener('touchstart', e => handleInput(e.touches[0].clientX));

        // --- æ¸¸æˆå®ä½“ç±» ---
        class Cloud {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = -60;
                this.radius = 22 + Math.random() * 10;
                this.speed = (1.0 + Math.random()) * speedMultiplier;
                this.value = 10;
                this.emoji = 'â˜ï¸';
                this.beingSucked = false;
            }
            update(dt) {
                if (magnetActive) {
                    const strengthRatio = magnetTimer / MAGNET_DURATION;
                    const currentRange = MAGNET_BASE_RANGE * (0.3 + 0.7 * strengthRatio);
                    const dx = player.x - this.x;
                    const dy = player.y - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < currentRange) {
                        this.beingSucked = true;
                        const force = (12 * strengthRatio) * (1 - dist / currentRange) + 2; 
                        this.x += (dx / dist) * force;
                        this.y += (dy / dist) * force;
                    } else { this.beingSucked = false; this.y += this.speed; }
                } else { this.beingSucked = false; this.y += this.speed; }
            }
            draw() {
                ctx.font = `${this.radius * 2}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.globalAlpha = this.beingSucked ? 0.7 : 0.95;
                ctx.fillText(this.emoji, this.x, this.y);
                ctx.globalAlpha = 1.0;
            }
        }

        class Obstacle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = -50;
                this.radius = 15;
                this.speed = (2.0 + Math.random() * 1.5) * speedMultiplier;
                this.emoji = 'ğŸ“Œ'; 
                this.rotation = Math.random() * Math.PI * 2;
                this.rotSpeed = (Math.random() - 0.5) * 0.1;
            }
            update() { this.y += this.speed; this.rotation += this.rotSpeed; }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.emoji, 0, 0);
                ctx.restore();
            }
        }

        class GameItem {
            constructor(type) {
                this.type = type; 
                this.x = Math.random() * (canvas.width - 40) + 20;
                this.y = -50;
                this.radius = 20;
                this.speed = 1.5 * speedMultiplier;
                this.wobble = Math.random() * Math.PI * 2;
                this.emoji = type === 'magnet' ? 'ğŸ§²' : 'ğŸ›¡ï¸';
            }
            update() { this.y += this.speed; this.wobble += 0.04; this.x += Math.sin(this.wobble) * 1.5; }
            draw() {
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.type === 'magnet' ? 'gold' : '#00bfff';
                ctx.font = '36px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.emoji, this.x, this.y);
                ctx.shadowBlur = 0;
            }
        }

        class Particle {
            constructor(x, y, text, color) {
                this.x = x; this.y = y; this.text = text; this.color = color || '#fff';
                this.life = 1.0;
                this.velocity = { x: (Math.random() - 0.5) * 3, y: -2 - Math.random() * 2 };
            }
            update() { this.x += this.velocity.x; this.y += this.velocity.y; this.life -= 0.02; }
            draw() {
                ctx.globalAlpha = Math.max(0, this.life);
                ctx.font = 'bold 20px Arial';
                ctx.fillStyle = this.color;
                ctx.fillText(this.text, this.x, this.y);
                ctx.globalAlpha = 1.0;
            }
        }

        // --- æ ¸å¿ƒå¾ªç¯ ---
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            const dt = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç©å®¶è·Ÿéš
            player.x += (player.targetX - player.x) * 0.1;
            if (player.x < player.radius) player.x = player.radius;
            if (player.x > canvas.width - player.radius) player.x = canvas.width - player.radius;

            // ç”Ÿæˆé€»è¾‘
            speedMultiplier = 1 + (score / 1500); 
            if (Math.random() < 0.025) clouds.push(new Cloud());
            if (Math.random() < 0.012) obstacles.push(new Obstacle());
            if (Math.random() < 0.0015) {
                const type = Math.random() > 0.5 ? 'magnet' : 'shield';
                items.push(new GameItem(type));
            }

            // æ›´æ–°å®ä½“
            [items, clouds, obstacles].forEach(arr => {
                for (let i = arr.length - 1; i >= 0; i--) {
                    let obj = arr[i];
                    
                    if(obj instanceof Cloud) obj.update(dt);
                    else obj.update();
                    
                    obj.draw();

                    // ç¢°æ’æ£€æµ‹
                    let dist = Math.hypot(player.x - obj.x, player.y - obj.y);
                    if (dist < player.radius + obj.radius - 8) {
                        if (obj instanceof GameItem) {
                            if (obj.type === 'magnet') { 
                                activateMagnet(); 
                                particles.push(new Particle(player.x, player.y - 30, "ç£é“!", "gold")); 
                            } else { 
                                addShield(); // å åŠ æŠ¤ç›¾
                                particles.push(new Particle(player.x, player.y - 30, "æŠ¤ç›¾+1", "#00bfff")); 
                            }
                            arr.splice(i, 1);
                        } else if (obj instanceof Cloud) {
                            score += obj.value;
                            document.getElementById('score-val').innerText = score;
                            particles.push(new Particle(obj.x, obj.y, "+10"));
                            arr.splice(i, 1);
                        } else if (obj instanceof Obstacle) {
                            if (currentShields > 0) {
                                useShield(); // æ¶ˆè€—æŠ¤ç›¾
                                particles.push(new Particle(obj.x, obj.y, "æŠµæ¶ˆ!", "#00bfff"));
                                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                                ctx.fillRect(0, 0, canvas.width, canvas.height);
                                arr.splice(i, 1);
                            } else {
                                gameOver();
                                return;
                            }
                        }
                    } else if (obj.y > canvas.height + 50) {
                        arr.splice(i, 1);
                    }
                }
            });

            // ç²’å­
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i]; p.update(); p.draw();
                if (p.life <= 0) particles.splice(i, 1);
            }

            // ç»˜åˆ¶ç©å®¶ç‰¹æ•ˆ
            // æŠ¤ç›¾ç»˜åˆ¶ï¼šå¦‚æœæœ‰å¤šä¸ªï¼Œç”»å¤šå±‚æˆ–è€…é¢œè‰²æ›´æ·±
            if (currentShields > 0) {
                ctx.beginPath();
                // æŠ¤ç›¾å¤§å°éšæ•°é‡å¾®è°ƒ
                let shieldRadius = player.radius + 12 + (currentShields - 1) * 2;
                if(shieldRadius > player.radius + 20) shieldRadius = player.radius + 20;
                
                ctx.arc(player.x, player.y, shieldRadius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(0, 191, 255, ${0.2 + currentShields * 0.1})`; // è¶Šå¤šé¢œè‰²è¶Šæ·±
                ctx.fill();
                ctx.strokeStyle = 'rgba(0, 191, 255, 0.8)'; 
                ctx.lineWidth = 3; 
                ctx.stroke();
            }

            if (magnetActive) {
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.radius + 5, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(255, 71, 87, ${magnetTimer/MAGNET_DURATION})`;
                ctx.lineWidth = 2; ctx.stroke();
                magnetTimer -= dt;
                updateMagnetUI();
                if (magnetTimer <= 0) { magnetActive = false; document.getElementById('magnet-status').classList.remove('active'); }
            }

            // ç»˜åˆ¶æ°”çƒä¸»ä½“
            ctx.font = `${player.radius * 2.5}px Arial`;
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillStyle = 'black';
            ctx.fillText(player.emoji, player.x, player.y);

            animationId = requestAnimationFrame(gameLoop);
        }

        // --- æ¸¸æˆæ§åˆ¶ä¸çŠ¶æ€ ---
        
        function activateMagnet() {
            magnetActive = true;
            magnetTimer = MAGNET_DURATION;
            document.getElementById('magnet-status').classList.add('active');
        }

        function addShield(count = 1) {
            currentShields += count;
            updateShieldUI();
        }

        function useShield() {
            currentShields--;
            if (currentShields < 0) currentShields = 0;
            
            // è§†è§‰åé¦ˆï¼šæ™ƒåŠ¨
            const status = document.getElementById('shield-status');
            status.classList.add('shake');
            setTimeout(() => status.classList.remove('shake'), 500);
            
            updateShieldUI();
        }

        function updateShieldUI() {
            const el = document.getElementById('shield-status');
            const countEl = document.getElementById('shield-count-val');
            
            if (currentShields > 0) {
                el.classList.add('active');
                countEl.innerText = currentShields;
            } else {
                el.classList.remove('active');
            }
        }

        function updateMagnetUI() {
            const pct = (magnetTimer / MAGNET_DURATION) * 100;
            document.getElementById('magnet-bar').style.width = `${pct}%`;
            document.getElementById('magnet-timer-text').innerText = `${Math.ceil(magnetTimer)}s`;
        }

        function startGame() {
            document.getElementById('menu-screen').classList.add('hidden');
            score = 0;
            document.getElementById('score-val').innerText = "0";
            
            clouds = []; obstacles = []; items = []; particles = [];
            
            magnetActive = false;
            document.getElementById('magnet-status').classList.remove('active');
            
            // é‡ç½®å¹¶åº”ç”¨è´­ä¹°çš„æŠ¤ç›¾
            currentShields = 0;
            if (purchasedBuffs.shieldCount > 0) {
                addShield(purchasedBuffs.shieldCount);
                // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬å†³å®šæ˜¯å¦æ¶ˆè€—æ‰è´­ä¹°çš„æŠ¤ç›¾
                // é€šå¸¸Roguelike/è·‘é…·æ¸¸æˆï¼Œè´­ä¹°æ˜¯å•å±€æ¶ˆè€—å“ã€‚
                purchasedBuffs.shieldCount = 0; 
            } else {
                updateShieldUI(); // ç¡®ä¿éšè—
            }

            // åº”ç”¨ç£é“
            if (purchasedBuffs.magnet) {
                activateMagnet();
                purchasedBuffs.magnet = false;
            }
            
            updateShopUI(); // æ›´æ–°å•†åº—æ˜¾ç¤ºï¼ˆå½’é›¶ï¼‰

            player.x = canvas.width / 2;
            gameRunning = true;
            lastTime = performance.now();
            animationId = requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            
            ctx.font = '60px Arial';
            ctx.fillText('ğŸ’¥', player.x, player.y);

            const inherited = Math.floor(score * 0.7);
            userWallet += inherited;
            updateWalletDisplay();

            document.getElementById('menu-title').innerText = "æ°”çƒç‚¸äº†ï¼";
            document.getElementById('result-panel').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('inherited-coins').innerText = `+${inherited}`;
            
            setTimeout(() => {
                document.getElementById('menu-screen').classList.remove('hidden');
            }, 800);
        }

        // --- å•†åº—é€»è¾‘ ---
        function openShop() {
            document.getElementById('shop-screen').classList.remove('hidden');
            updateShopUI();
        }

        function closeShop() {
            document.getElementById('shop-screen').classList.add('hidden');
        }

        function buyItem(type, cost) {
            if (userWallet >= cost) {
                if (type === 'shield') {
                    // æŠ¤ç›¾å¯ä»¥ä¹°å¤šä¸ª
                    userWallet -= cost;
                    purchasedBuffs.shieldCount++;
                } else if (type === 'magnet' && !purchasedBuffs.magnet) {
                    // ç£é“åªèƒ½ä¹°ä¸€ä¸ª
                    userWallet -= cost;
                    purchasedBuffs.magnet = true;
                }
                updateWalletDisplay();
                updateShopUI();
            }
        }

        function updateShopUI() {
            // æ›´æ–°æŠ¤ç›¾æŒ‰é’®ï¼ˆå¯æ— é™è´­ä¹°ï¼‰
            const btnShield = document.querySelector('#item-shield .btn-buy');
            const shopShieldBadge = document.getElementById('shop-shield-count');
            
            btnShield.disabled = userWallet < 200;
            if (purchasedBuffs.shieldCount > 0) {
                shopShieldBadge.style.display = 'inline-block';
                shopShieldBadge.innerText = `å·²è´­: ${purchasedBuffs.shieldCount}`;
            } else {
                shopShieldBadge.style.display = 'none';
            }

            // æ›´æ–°ç£é“æŒ‰é’®ï¼ˆé™è´­ä¸€ä¸ªï¼‰
            const btnMagnet = document.querySelector('#item-magnet .btn-buy');
            const itemMagnet = document.getElementById('item-magnet');
            
            if (purchasedBuffs.magnet) {
                btnMagnet.innerText = "å·²è´­ä¹°";
                btnMagnet.disabled = true;
                itemMagnet.classList.add('purchased');
            } else {
                btnMagnet.innerText = "350 ğŸ’°";
                btnMagnet.disabled = userWallet < 350;
                itemMagnet.classList.remove('purchased');
            }
        }

    </script>
</body>
</html>
